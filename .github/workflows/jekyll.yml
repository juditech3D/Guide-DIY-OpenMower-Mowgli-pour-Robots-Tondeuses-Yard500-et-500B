---
  name: Deploy Jekyll site to Pages
  on:
    push:
      branches:
        - main
  permissions:
    contents: read
    pages: write
    id-token: write
  jobs:
    build:
      runs-on: ubuntu-22.04
      steps:
        - name: Checkout code
          uses: actions/checkout@v4
        - name: Cache Ruby gems
          uses: actions/cache@v3
          with:
            path: vendor/bundle
            key: ${{ runner.os }}-gem-${{ hashFiles('**/Gemfile.lock') }}
            restore-keys: |
              ${{ runner.os }}-gem-
        - name: Setup Ruby
          uses: ruby/setup-ruby@v1
          with:
            ruby-version: "3.2.8"
            bundler-cache: true
        - name: Force Ruby platform
          run: bundle config set force_ruby_platform true
        - name: Install dependencies
          run: bundle install
        - name: Build site with Jekyll
          run: bundle exec jekyll build
        - name: Check built files
          run: ls -la _site
        - name: Upload site artifact
          uses: actions/upload-pages-artifact@v3
          with:
            path: _site
    deploy:
      needs: build
      runs-on: ubuntu-22.04
      environment:
        name: github-pages
          url: ${{ steps.deployment.outputs.page_url }}
      steps:
        - name: Deploy to GitHub Pages
          id: deployment
          uses: actions/deploy-pages@v2
